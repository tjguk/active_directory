

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>active_directory – Windows Active Directory Management &mdash; active_directory v1.0rc1 documentation</title>
    <link rel="stylesheet" href="_static/active_directory.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '1.0rc1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="active_directory v1.0rc1 documentation" href="index.html" />
    <link rel="next" title="Changes" href="changes.html" />
    <link rel="prev" title="active_directory Cookbook" href="cookbook.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="changes.html" title="Changes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cookbook.html" title="active_directory Cookbook"
             accesskey="P">previous</a> |</li>
        <li><a href="contents.html">active_directory v1.0rc1 documentation</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="module-active_directory">
<h1><a title="" class="reference external" href="#module-active_directory"><tt class="xref docutils literal"><span class="pre">active_directory</span></tt></a> &#8211; Windows Active Directory Management<a class="headerlink" href="#module-active_directory" title="Permalink to this headline">¶</a></h1>
<dl class="docutils">
<dt>active_directory - a lightweight wrapper around COM support</dt>
<dd>for Microsoft&#8217;s Active Directory</dd>
</dl>
<p>Active Directory is Microsoft&#8217;s answer to LDAP, the industry-standard
directory service holding information about users, computers and
other resources in a tree structure, arranged by departments or
geographical location, and optimized for searching.</p>
<p>There are several ways of attaching to Active Directory. This
module uses the Dispatchable <a class="reference external" href="LDAP://">LDAP://</a> objects and wraps them
lightly in helpful Python classes which do a bit of the
otherwise tedious plumbing. The module is quite naive, and
has only really been developed to aid searching, but since
you can always access the original COM object, there&#8217;s nothing
to stop you using it for any AD operations.</p>
<ul>
<li><p class="first">The active directory class (_AD_object or a subclass) will determine
its properties and allow you to access them as instance properties:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">active_directory</span>
<span class="n">goldent</span> <span class="o">=</span> <span class="n">active_directory</span><span class="o">.</span><span class="n">find_user</span> <span class="p">(</span><span class="s">&quot;goldent&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">ad</span><span class="o">.</span><span class="n">displayName</span>
</pre></div>
</div>
</li>
<li><p class="first">Any object returned by the AD object&#8217;s operations is themselves
wrapped as AD objects so you get the same benefits:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">active_directory</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">active_directory</span><span class="o">.</span><span class="n">root</span> <span class="p">()</span><span class="o">.</span><span class="n">child</span> <span class="p">(</span><span class="s">&quot;cn=users&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="o">.</span><span class="n">search</span> <span class="p">(</span><span class="s">&quot;displayName=&#39;Tim*&#39;&quot;</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">displayName</span>
</pre></div>
</div>
</li>
<li><p class="first">To search the AD, there are two module-level general
search functions, and module-level convenience functions
to find a user, computer etc. Usage is illustrated below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">active_directory</span> <span class="kn">as</span> <span class="nn">ad</span>

<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">ad</span><span class="o">.</span><span class="n">search</span> <span class="p">(</span>
  <span class="s">&quot;objectClass=&#39;User&#39;&quot;</span><span class="p">,</span>
  <span class="s">&quot;displayName=&#39;Tim Golden&#39; OR sAMAccountName=&#39;goldent&#39;&quot;</span>
<span class="p">):</span>
  <span class="c">#</span>
  <span class="c"># This search returns an _AD_object</span>
  <span class="c">#</span>
  <span class="k">print</span> <span class="n">user</span>

<span class="n">query</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">  SELECT Name, displayName</span>
<span class="s">  FROM &#39;LDAP://cn=users,DC=gb,DC=vo,DC=local&#39;</span>
<span class="s">  WHERE displayName = &#39;John*&#39;</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">ad</span><span class="o">.</span><span class="n">search_ex</span> <span class="p">(</span><span class="n">query</span><span class="p">):</span>
  <span class="c">#</span>
  <span class="c"># This search returns an ADO_object, which</span>
  <span class="c">#  is faster but doesn&#39;t give the convenience</span>
  <span class="c">#  of the AD methods etc.</span>
  <span class="c">#</span>
  <span class="k">print</span> <span class="n">user</span>

<span class="k">print</span> <span class="n">ad</span><span class="o">.</span><span class="n">find_user</span> <span class="p">(</span><span class="s">&quot;goldent&quot;</span><span class="p">)</span>

<span class="k">print</span> <span class="n">ad</span><span class="o">.</span><span class="n">find_computer</span> <span class="p">(</span><span class="s">&quot;vogbp200&quot;</span><span class="p">)</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">AD</span> <span class="p">()</span><span class="o">.</span><span class="n">child</span> <span class="p">(</span><span class="s">&quot;cn=users&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span><span class="o">.</span><span class="n">search</span> <span class="p">(</span><span class="s">&quot;displayName=&#39;Tim*&#39;&quot;</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">u</span>
</pre></div>
</div>
</li>
<li><p class="first">Typical usage will be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">active_directory</span>

<span class="k">for</span> <span class="n">computer</span> <span class="ow">in</span> <span class="n">active_directory</span><span class="o">.</span><span class="n">search</span> <span class="p">(</span><span class="s">&quot;objectClass=&#39;computer&#39;&quot;</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">computer</span><span class="o">.</span><span class="n">displayName</span>
</pre></div>
</div>
</li>
</ul>
<p>(c) Tim Golden &lt;<a class="reference external" href="mailto:active-directory&#37;&#52;&#48;timgolden&#46;me&#46;uk">active-directory<span>&#64;</span>timgolden<span>&#46;</span>me<span>&#46;</span>uk</a>&gt; October 2004
Licensed under the (GPL-compatible) MIT License:
<a class="reference external" href="http://www.opensource.org/licenses/mit-license.php">http://www.opensource.org/licenses/mit-license.php</a></p>
<p>Many thanks, obviously to Mark Hammond for creating
the pywin32 extensions without which this wouldn&#8217;t
have been possible.</p>
<div class="section" id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<p>All COM-related exceptions are wrapped in <a title="active_directory.ActiveDirectoryError" class="reference internal" href="#active_directory.ActiveDirectoryError"><tt class="xref docutils literal"><span class="pre">ActiveDirectoryError</span></tt></a> or one of its
subclasses. Therefore you can safely trap <a title="active_directory.ActiveDirectoryError" class="reference internal" href="#active_directory.ActiveDirectoryError"><tt class="xref docutils literal"><span class="pre">ActiveDirectoryError</span></tt></a> as a root exception.</p>
<dl class="exception">
<dt id="active_directory.ActiveDirectoryError">
<em class="property">exception </em><tt class="descclassname">active_directory.</tt><tt class="descname">ActiveDirectoryError</tt><a class="headerlink" href="#active_directory.ActiveDirectoryError" title="Permalink to this definition">¶</a></dt>
<dd>Base class for all AD Exceptions</dd></dl>

</div>
<div class="section" id="support-classes-functions">
<h2>Support Classes &amp; Functions<a class="headerlink" href="#support-classes-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="active_directory.connect">
<tt class="descclassname">active_directory.</tt><tt class="descname">connect</tt><big>(</big><em>username=None</em>, <em>password=None</em><big>)</big><a class="headerlink" href="#active_directory.connect" title="Permalink to this definition">¶</a></dt>
<dd>Return an ADODB connection, optionally authenticated by
username &amp; password.</dd></dl>

<dl class="function">
<dt id="active_directory.query">
<tt class="descclassname">active_directory.</tt><tt class="descname">query</tt><big>(</big><em>query_string</em>, <em>connection=None</em>, <em>**command_properties</em><big>)</big><a class="headerlink" href="#active_directory.query" title="Permalink to this definition">¶</a></dt>
<dd><p>Basic AD query, passing a raw query string straight through to an
Active Directory, optionally using a (possibly pre-authenticated) connection
or creating one on demand. command_properties may be specified which will be
passed through to the ADO command with underscores replaced by spaces. Useful
values include:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr><td>page_size</td>
<td>How many records to return in one go</td>
</tr>
<tr><td>size_limit</td>
<td>Stop after returning this many records</td>
</tr>
<tr><td>cache_results</td>
<td>Boolean: cache results; turn off if a large result</td>
</tr>
<tr><td>time_limit</td>
<td>Stop returning records after this many seconds</td>
</tr>
<tr><td>timeout</td>
<td>Stop waiting for the records to start after this many seconds</td>
</tr>
<tr><td>asynchronous</td>
<td>Boolean: Start returning records immediately</td>
</tr>
<tr><td>sort_on</td>
<td>field name to sort on</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>query_string</em> &#8211; An AD query string in any acceptable format. See <a title="active_directory.query_string" class="reference internal" href="#active_directory.query_string"><tt class="xref docutils literal"><span class="pre">query_string()</span></tt></a>
for an easy way of producing this</li>
<li><em>connection</em> &#8211; (optional) An ADODB.Connection, as provided by <a title="active_directory.connect" class="reference internal" href="#active_directory.connect"><tt class="xref docutils literal"><span class="pre">connect()</span></tt></a>. If
this is supplied it will be used and not closed. If it is not supplied, a default connection
will be created, used and then closed.</li>
<li><em>command_properties</em> &#8211; A collection of keywords which will be passed through to the
ADO query as Properties.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="active_directory.query_string">
<tt class="descclassname">active_directory.</tt><tt class="descname">query_string</tt><big>(</big><em>base=None</em>, <em>filter=''</em>, <em>attributes='*'</em>, <em>scope='Subtree'</em>, <em>range=None</em><big>)</big><a class="headerlink" href="#active_directory.query_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Easy way to produce a valid AD query string, with meaninful defaults. This
is the first parameter to the <a title="active_directory.query" class="reference internal" href="#active_directory.query"><tt class="xref docutils literal"><span class="pre">query()</span></tt></a> function so the following will
yield the display name of every user in the domain:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">active_directory</span> <span class="kn">as</span> <span class="nn">ad</span>

<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">ad</span><span class="o">.</span><span class="n">query</span> <span class="p">(</span>
  <span class="n">ad</span><span class="o">.</span><span class="n">query_string</span> <span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="s">&quot;(objectClass=User)&quot;</span><span class="p">,</span> <span class="n">attributes</span><span class="o">=</span><span class="s">&quot;displayName&quot;</span><span class="p">)</span>
<span class="p">):</span>
  <span class="k">print</span> <span class="n">u</span><span class="p">[</span><span class="s">&#39;displayName&#39;</span><span class="p">]</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>base</em> &#8211; An <a class="reference external" href="LDAP://">LDAP://</a> moniker representing the starting point of the search [domain root]</li>
<li><em>filter</em> &#8211; An AD filter string to limit the search [no filter]</li>
<li><em>attributes</em> &#8211; A comma-separated attributes string [* - ADsPath]</li>
<li><em>scope</em> &#8211; One of - Subtree, Base, OneLevel [Subtree]</li>
<li><em>range</em> &#8211; Limit the number of returns of multivalued attributes [no range]</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="main-entry-points">
<h2>Main Entry Points<a class="headerlink" href="#main-entry-points" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="active_directory.ad">
<tt class="descclassname">active_directory.</tt><tt class="descname">ad</tt><big>(</big><em>obj_or_path</em>, <em>username=None</em>, <em>password=None</em><big>)</big><a class="headerlink" href="#active_directory.ad" title="Permalink to this definition">¶</a></dt>
<dd><p>Factory function for suitably-classed Active Directory
objects from an incoming path or object. NB The interface
is now  intended to be:</p>
<blockquote>
ad (obj_or_path)</blockquote>
<p>&#64;param obj_or_path Either an COM AD object or the path to one. If
the path doesn&#8217;t start with &#8220;<a class="reference external" href="LDAP://">LDAP://</a>&#8221; this will be prepended.</p>
<p>&#64;return An _AD_object or a subclass proxying for the AD object</p>
</dd></dl>

<dl class="function">
<dt id="active_directory.find_user">
<tt class="descclassname">active_directory.</tt><tt class="descname">find_user</tt><big>(</big><em>name=None</em><big>)</big><a class="headerlink" href="#active_directory.find_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="active_directory.find_group">
<tt class="descclassname">active_directory.</tt><tt class="descname">find_group</tt><big>(</big><em>name</em><big>)</big><a class="headerlink" href="#active_directory.find_group" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="active_directory.find_ou">
<tt class="descclassname">active_directory.</tt><tt class="descname">find_ou</tt><big>(</big><em>name</em><big>)</big><a class="headerlink" href="#active_directory.find_ou" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="active_directory.search">
<tt class="descclassname">active_directory.</tt><tt class="descname">search</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#active_directory.search" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="changes.html" title="Changes"
             >next</a> |</li>
        <li class="right" >
          <a href="cookbook.html" title="active_directory Cookbook"
             >previous</a> |</li>
        <li><a href="contents.html">active_directory v1.0rc1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Tim Golden.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.
    </div>
  </body>
</html>